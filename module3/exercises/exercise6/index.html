<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 50%; margin: auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 10px; }
        .error { color: red; display: none; }
    </style>
</head>
<body>
<h2>Customer List</h2>

<!-- Live Search Input -->
<input type="text" id="search" placeholder="Search by name">
<p class="error" id="search-error">No products found</p>

<!-- Table to display customers -->
<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>email</th>
        <th>phone</th>
        <th>city</th>
    </tr>
    </thead>
    <tbody id="customer-list"></tbody>
</table>

<h2>Add Product</h2>
<form id="add-product-form">
    <input type="text" id="name" placeholder="Product Name" required>
    <input type="number" id="price" placeholder="Price" required>
    <button type="submit">Add Product</button>
</form>
<p class="error" id="error-msg">Invalid input</p>

<div id="updateform" hidden="true">
    <h2>Update Product</h2>
    <form id="update-product-form">
        <input type="number" id="update-id" placeholder="Product ID" readonly required>
        <input type="text" id="update-name" placeholder="New Name">
        <input type="number" id="update-price" placeholder="New Price">
        <button type="submit">Update Product</button>
    </form>
    <p class="error" id="update-error-msg">Invalid input</p>
</div>
<script>
    $(document).ready(function(){
        let debounceTimer;

        function loadCustomers() {
            $.get("/api/customers", function(customers){
                $("#customer-list").empty(); // Clear the existing list
                customers.forEach(customer => {
                    $("#customer-list").append(`
                            <tr>
                                <td>${customer.id}</td>
                                <td>${customer.name}</td>
                                <td>${customer.email}</td>
                                <td>${customer.phone}</td>
                                <td>${customer.city}</td>
                                <td>
                                    <button class="delete-btn" data-id="${customer.id}">Delete</button>
                                </td>
                            </tr>
                        `);
                });
            });
        }

        /*function loadProducts(query = "") {
            let url = query ? `/api/products?name=${encodeURIComponent(query)}` : "/api/products";
            $.get(url, function(products){
                $("#product-list").empty();
                if (products.length === 0) {
                    $("#search-error").show();
                } else {
                    $("#search-error").hide();
                    products.forEach(product => {
                        $("#product-list").append(`
                                <tr>
                                    <td>${product.id}</td>
                                    <td>${product.name}</td>
                                    <td>${product.price}</td>
                                    <td>
                                        <button class="edit-btn" data-id="${product.id}">Edit</button>
                                        <button class="delete-btn" data-id="${product.id}">Delete</button>
                                    </td>
                                </tr>
                            `);
                    });
                }
            });
        }*/
/*
        $("#add-product-form").submit(function(event){
            event.preventDefault();
            let name = $("#name").val().trim();
            let price = parseFloat($("#price").val().trim());

            if (!name || isNaN(price) || price <= 0) {
                $("#error-msg").fadeIn().delay(5000).fadeOut();
                return;
            }

            $.post({
                url: "/api/products",
                contentType: "application/json",
                data: JSON.stringify({ name, price }),
                success: function() {
                    loadProducts();
                    $("#name, #price").val("");
                }
            });
        });

        $("#product-list").on("click", ".delete-btn", function() {
            let id = $(this).data("id");
            $.ajax({
                url: `/api/products/${id}`,
                type: "DELETE",
                success: function() {
                    loadProducts();
                }
            });
        });


        //$("#search"):This is a jQuery selector that selects an HTML element with the id of search.
        // The .on() method is used to attach an event handler to the selected element(s).
        // "keyup" is the event type being listened for. The keyup event is triggered when a keyboard key is released after being pressed.
        // function() { ... } is the callback function that will be executed when the keyup event occurs.

        $("#search").on("keyup", function() { // attaches an event listener to the search input field (#search). The event triggers whenever the user releases a key (keyup event).
            clearTimeout(debounceTimer); // Clears any previously set timer (debounceTimer) to prevent multiple requests being sent in quick succession.
            let query = $(this).val().trim();
            debounceTimer = setTimeout(() => { //Sets a delay of 300 milliseconds before calling loadProducts(query).
                loadProducts(query);
            }, 300);
        });

        $("#update-product-form").submit(function(event){
            event.preventDefault();
            let id = parseInt($("#update-id").val().trim());
            let name = $("#update-name").val().trim();
            let price = parseFloat($("#update-price").val().trim());

            if (isNaN(id) || id <= 0 || (!name && isNaN(price))) {
                $("#update-error-msg").fadeIn().delay(5000).fadeOut();
                return;
            }

            $.ajax({
                url: `/api/products/${id}`,
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify({ name, price }),
                success: function() {
                    loadProducts();
                    $("#update-id, #update-name, #update-price").val("");
                }
            });
        });

        // Load product data into update form when "Edit" is clicked
        $("#product-list").on("click", ".edit-btn", function() {
            let id = $(this).data("id");
            $("#updateform").fadeIn(2000);
            $.get(`/api/products/${id}`, function(product) {
                $("#update-id").val(product.id);
                $("#update-name").val(product.name);
                $("#update-price").val(product.price);
            });
        });*/

        loadCustomers();
    });
</script>
</body>
</html>
